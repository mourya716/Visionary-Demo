<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuroMed AI | Sentient Medical Interface</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Outfit:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-deep: #050505;
            --panel-bg: rgba(20, 20, 30, 0.6);
            --border: rgba(255, 255, 255, 0.1);
            --neon-blue: #00f3ff;
            --neon-green: #0aff0a;
            --danger: #ff003c;
            --text-main: #e0e0e0;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Outfit', sans-serif; }

        body {
            background-color: var(--bg-deep);
            color: var(--text-main);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- 1. THE CINEMATIC BOOT SEQUENCE --- */
        #boot-layer {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #000;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: flex-start;
            padding: 5rem;
            font-family: 'JetBrains Mono', monospace;
            color: var(--neon-green);
        }

        .boot-line {
            opacity: 0;
            margin-bottom: 5px;
            text-shadow: 0 0 10px var(--neon-green);
        }

        .cursor {
            display: inline-block;
            width: 10px; height: 20px;
            background: var(--neon-green);
            animation: blink 0.5s infinite;
        }

        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
        
        /* Fade out boot screen */
        .boot-finish { animation: fadeOut 1s forwards; pointer-events: none; }
        @keyframes fadeOut { to { opacity: 0; visibility: hidden; } }

        /* --- 2. MAIN INTERFACE (Glassmorphism) --- */
        #app-layer {
            opacity: 0; /* Hidden until boot finishes */
            transition: opacity 2s ease;
            height: 100%;
            display: flex;
            flex-direction: column;
            background: radial-gradient(circle at center, #1a1a2e 0%, #000000 100%);
        }

        header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
        }

        .brand { font-family: 'JetBrains Mono'; font-weight: 700; letter-spacing: -1px; font-size: 1.5rem; color: white; }
        .brand span { color: var(--neon-blue); }

        .api-pill {
            font-size: 0.75rem; 
            background: rgba(0, 243, 255, 0.1); 
            border: 1px solid var(--neon-blue); 
            color: var(--neon-blue); 
            padding: 4px 12px; 
            border-radius: 99px;
            display: flex; align-items: center; gap: 8px;
        }

        /* GRID LAYOUT */
        main {
            flex: 1;
            display: grid;
            grid-template-columns: 320px 1fr 320px;
            gap: 1.5rem;
            padding: 1.5rem;
            overflow: hidden;
        }

        /* PANELS */
        .glass-panel {
            background: var(--panel-bg);
            border: 1px solid var(--border);
            border-radius: 16px;
            backdrop-filter: blur(20px);
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
        }

        .panel-head {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            font-family: 'JetBrains Mono';
            font-size: 0.8rem;
            text-transform: uppercase;
            color: var(--text-main);
            letter-spacing: 1px;
            display: flex; align-items: center; gap: 10px;
        }

        /* CHAT AREA */
        .chat-scroll-area {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            scroll-behavior: smooth;
        }

        .msg {
            max-width: 80%;
            position: relative;
            animation: slideUp 0.4s ease;
        }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .msg-patient { align-self: flex-start; }
        .msg-doctor { align-self: flex-end; text-align: right; }

        .bubble {
            padding: 1rem 1.25rem;
            border-radius: 12px;
            font-size: 1rem;
            line-height: 1.6;
            position: relative;
        }

        .msg-patient .bubble {
            background: rgba(139, 92, 246, 0.2);
            border: 1px solid rgba(139, 92, 246, 0.5);
            color: #ddd6fe;
            border-bottom-left-radius: 0;
        }

        .msg-doctor .bubble {
            background: rgba(14, 165, 233, 0.2);
            border: 1px solid rgba(14, 165, 233, 0.5);
            color: #bae6fd;
            border-bottom-right-radius: 0;
        }

        .translation {
            display: block;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid rgba(255,255,255,0.1);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: var(--neon-blue);
        }

        /* CONTROLS */
        .controls {
            padding: 1.5rem;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: center;
            gap: 20px;
            background: rgba(0,0,0,0.3);
        }

        .mic-btn {
            width: 70px; height: 70px;
            border-radius: 50%;
            border: 1px solid var(--neon-blue);
            background: rgba(0, 243, 255, 0.1);
            color: var(--neon-blue);
            font-size: 1.5rem;
            cursor: pointer;
            transition: 0.3s;
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .mic-btn:hover { background: var(--neon-blue); color: #000; box-shadow: 0 0 40px var(--neon-blue); }
        
        .mic-btn.processing::after {
            content: ''; position: absolute; top:0; left:0; width:100%; height:100%;
            border-top: 2px solid white; border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .mode-btn {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-main);
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.3s;
            font-family: 'JetBrains Mono';
        }
        .mode-btn.active { background: var(--text-main); color: #000; font-weight: bold; box-shadow: 0 0 15px white; }

        /* ANALYSIS PANEL */
        .stat-box {
            background: rgba(255,255,255,0.03);
            margin: 1rem;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid var(--border);
        }
        .stat-label { font-size: 0.7rem; color: #aaa; text-transform: uppercase; margin-bottom: 5px; }
        .stat-val { font-size: 1.5rem; font-weight: 600; font-family: 'JetBrains Mono'; }
        
        .risk-high { color: var(--danger); text-shadow: 0 0 10px var(--danger); animation: pulseRed 2s infinite; }
        .risk-low { color: var(--neon-green); }
        
        @keyframes pulseRed { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        /* SCROLLBAR */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 10px; }

    </style>
</head>
<body>

    <div id="boot-layer">
        <div id="boot-text"></div>
        <div class="cursor"></div>
    </div>

    <div id="app-layer">
        <header>
            <div class="brand">NeuroMed<span>.AI</span></div>
            <div class="api-pill">
                <i class="fas fa-satellite-dish"></i> GEMINI-1.5 CONNECTED
            </div>
        </header>

        <main>
            <section class="glass-panel">
                <div class="panel-head"><i class="fas fa-stream"></i> Real-Time Feed</div>
                <div style="padding: 1.5rem; flex: 1; display:flex; flex-direction:column;">
                    <div class="stat-label">DETECTED LANGUAGE</div>
                    <div id="lang-display" style="font-size: 1.2rem; color: var(--neon-blue); margin-bottom: 20px;">Waiting for input...</div>
                    
                    <div class="stat-label">LIVE TRANSCRIPT</div>
                    <div id="live-text" style="font-family: 'JetBrains Mono'; color: #0aff0a; line-height:1.5;">Listening...</div>
                    
                    <div style="margin-top:auto; font-size:0.75rem; color:#666;">
                        > Secure Connection Established<br>
                        > Latency: 42ms<br>
                        > Model: Gemini 1.5 Flash
                    </div>
                </div>
            </section>

            <section class="glass-panel">
                <div class="panel-head" style="justify-content:center;">CONSULTATION INTERFACE</div>
                
                <div class="chat-scroll-area" id="chat-box">
                    <div class="msg msg-doctor">
                        <div class="bubble">
                            System initialized. I am ready to translate any medical emergency.
                            <span class="translation">Mode: Universal Translator</span>
                        </div>
                    </div>
                </div>

                <div class="controls">
                    <button class="mode-btn active" id="btn-patient" onclick="setMode('patient')">PATIENT</button>
                    <button class="mode-btn" id="btn-doctor" onclick="setMode('doctor')">DOCTOR</button>
                    <button class="mic-btn" id="mic-btn" onclick="toggleMic()">
                        <i class="fas fa-microphone"></i>
                    </button>
                </div>
            </section>

            <section class="glass-panel">
                <div class="panel-head"><i class="fas fa-dna"></i> AI Diagnostics</div>
                
                <div class="stat-box">
                    <div class="stat-label">Primary Symptom</div>
                    <div class="stat-val" id="val-symptom">--</div>
                </div>

                <div class="stat-box">
                    <div class="stat-label">Body Temperature (Est.)</div>
                    <div class="stat-val" id="val-temp">--</div>
                </div>

                <div class="stat-box">
                    <div class="stat-label">Urgency Level</div>
                    <div class="stat-val" id="val-risk">--</div>
                </div>

                <div style="padding:1rem; text-align:center;">
                    <i class="fas fa-fingerprint" style="font-size:3rem; color:rgba(255,255,255,0.05);"></i>
                </div>
            </section>
        </main>
    </div>

    <script>
        // --- 1. BOOT SEQUENCE LOGIC ---
        const bootText = [
            "Initializing NeuroLink Kernel v2.4...",
            "Loading Modules: [Speech] [Vision] [Gemini-1.5]...",
            "Decrypting Medical Databases...",
            "Connecting to Global Health Servers...",
            "> Connection Established.",
            "> Biometrics Active.",
            "Welcome, Administrator."
        ];

        let lineIndex = 0;
        const bootContainer = document.getElementById('boot-text');

        function typeWriter() {
            if (lineIndex < bootText.length) {
                const line = document.createElement('div');
                line.className = 'boot-line';
                line.innerText = bootText[lineIndex];
                bootContainer.appendChild(line);
                
                // Trigger Fade In
                setTimeout(() => line.style.opacity = 1, 50);
                
                lineIndex++;
                setTimeout(typeWriter, 300); // Speed of typing
            } else {
                setTimeout(finishBoot, 800);
            }
        }

        function finishBoot() {
            document.getElementById('boot-layer').classList.add('boot-finish');
            document.getElementById('app-layer').style.opacity = 1;
        }

        // Start Boot on Load
        window.onload = typeWriter;


        // --- 2. GEMINI API CONFIGURATION ---
        // Your Key:
        const API_KEY = "AIzaSyBC3inpQnxtuKxoWB06Lo-gM_MHj1bY5SM"; 
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`;

        let isListening = false;
        let mode = 'patient';
        let recognition;
        const synth = window.speechSynthesis;

        // --- 3. SPEECH RECOGNITION ---
        if ('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = true;
            recognition.lang = 'en-IN'; // Works for Hinglish/English mix

            recognition.onstart = () => {
                isListening = true;
                document.getElementById('mic-btn').style.background = "var(--danger)";
                document.getElementById('live-text').innerText = "Listening...";
            };

            recognition.onend = () => {
                isListening = false;
                document.getElementById('mic-btn').style.background = "rgba(0, 243, 255, 0.1)";
            };

            recognition.onresult = (event) => {
                let finalTranscript = '';
                for (let i = event.resultIndex; i < event.results.length; ++i) {
                    if (event.results[i].isFinal) {
                        finalTranscript = event.results[i][0].transcript;
                        handleInput(finalTranscript); // Send to Gemini
                    } else {
                        document.getElementById('live-text').innerText = event.results[i][0].transcript;
                    }
                }
            };
        }

        function toggleMic() {
            if (isListening) recognition.stop();
            else recognition.start();
        }

        function setMode(newMode) {
            mode = newMode;
            document.getElementById('btn-patient').classList.toggle('active', mode === 'patient');
            document.getElementById('btn-doctor').classList.toggle('active', mode === 'doctor');
        }

        // --- 4. THE AI BRAIN (CALLING GEMINI) ---
        async function handleInput(text) {
            document.getElementById('live-text').innerText = text;
            document.getElementById('mic-btn').classList.add('processing'); // Spin animation
            
            // Construct the Prompt
            let prompt = "";
            
            if (mode === 'patient') {
                prompt = `
                    You are a Medical AI Translator for Tribal India. 
                    Input Text: "${text}"
                    
                    Task:
                    1. Identify the language (Hindi, English, or any Indian language).
                    2. Translate it into clear English for the Doctor.
                    3. Extract medical data (Symptom, Estimated Temp based on context, Urgency Level).
                    
                    Return JSON ONLY:
                    {
                        "translation": "Translated text here",
                        "detected_lang": "Language Name",
                        "symptom": "Main Symptom",
                        "temp": "98F (or higher if fever mentioned)",
                        "risk": "Low/Medium/High"
                    }
                `;
            } else {
                prompt = `
                    You are a Medical AI Translator.
                    Input Text: "${text}"
                    
                    Task:
                    1. Translate this Doctor's advice into a mix of "Simple Hindi + Santali" (Tribal Dialect style) so a rural patient understands. 
                    2. Use words like 'Jom' (Eat), 'Ran' (Medicine), 'Haso' (Pain).
                    
                    Return JSON ONLY:
                    {
                        "translation": "Translated Tribal text here",
                        "detected_lang": "English/Hindi"
                    }
                `;
            }

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }]
                    })
                });

                const data = await response.json();
                const aiText = data.candidates[0].content.parts[0].text;
                
                // Parse JSON from Gemini (Cleaning code blocks if present)
                const cleanJson = aiText.replace(/```json/g, '').replace(/```/g, '').trim();
                const result = JSON.parse(cleanJson);

                updateUI(text, result);

            } catch (error) {
                console.error("Gemini Error:", error);
                alert("AI Connection Failed. Check Console.");
            }
            
            document.getElementById('mic-btn').classList.remove('processing');
        }

        // --- 5. UPDATING THE UI ---
        function updateUI(original, data) {
            const chatBox = document.getElementById('chat-box');
            
            // 1. Create Message Bubble
            const div = document.createElement('div');
            div.className = `msg msg-${mode}`;
            div.innerHTML = `
                <div class="bubble">
                    ${original}
                    <span class="translation">
                        <i class="fas fa-language"></i> ${data.translation}
                    </span>
                </div>
            `;
            chatBox.appendChild(div);
            
            // Scroll to bottom
            setTimeout(() => chatBox.scrollTop = chatBox.scrollHeight, 100);

            // Speak the translation
            speak(data.translation);

            // 2. Update Vitals (Only in Patient Mode)
            if (mode === 'patient') {
                document.getElementById('lang-display').innerText = data.detected_lang;
                document.getElementById('val-symptom').innerText = data.symptom || "--";
                document.getElementById('val-temp').innerText = data.temp || "--";
                
                const riskEl = document.getElementById('val-risk');
                riskEl.innerText = data.risk || "Evaluating";
                
                if (data.risk === 'High' || data.risk === 'Critical') {
                    riskEl.className = 'stat-val risk-high';
                } else {
                    riskEl.className = 'stat-val risk-low';
                }
            }
        }

        function speak(text) {
            const u = new SpeechSynthesisUtterance(text);
            u.lang = 'hi-IN'; // Hindi accent works best for Tribal/Indian context
            synth.speak(u);
        }

    </script>
</body>
</html>
